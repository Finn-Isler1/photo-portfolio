---
import GalleryItem from "./GalleryItem.astro";
import photoData from "../data/photos.json";

export interface Props {
  columns?: number;
  selectedTags?: string[];
  sortBy?: "name" | "tag" | "id";
}

const { columns = 4, selectedTags = [], sortBy = "name" } = Astro.props;

// Filter by tags if provided
let filteredPhotos =
  selectedTags.length > 0
    ? photoData.filter((item) =>
        selectedTags.some((tag) => item.tags?.includes(tag))
      )
    : photoData;

// Sort by selected method
if (sortBy === "tag") {
  filteredPhotos.sort((a, b) => {
    const aTag = a.tags?.[0] || "";
    const bTag = b.tags?.[0] || "";
    return aTag.localeCompare(bTag);
  });
} else if (sortBy === "name") {
  filteredPhotos.sort((a, b) => a.name.localeCompare(b.name));
} else if (sortBy === "id") {
  filteredPhotos.sort((a, b) => a.id - b.id);
}

// Get unique tags for reference
const allTags = Array.from(
  new Set(photoData.flatMap((item) => item.tags || []))
).sort();
---

<div class={`gallery-grid cols-${columns}`}>
  {filteredPhotos.map((item) => <GalleryItem {...item} />)}
</div>

<div id="modal" class="modal">
  <button class="modal-close">&times;</button>
  <div class="modal-content">
    <img id="modal-image" src="" alt="" />
  </div>
  <button class="modal-nav modal-prev">&lt;</button>
  <button class="modal-nav modal-next">&gt;</button>
</div>

<style>
  .gallery-grid {
    column-count: var(--columns, 4);
    column-gap: 1rem;
    padding: 1rem;
  }

  /* column responsive */
  @media (max-width: 1400px) {
    .gallery-grid {
      column-count: 3;
    }
  }

  @media (max-width: 900px) {
    .gallery-grid {
      column-count: 2;
    }
  }

  @media (max-width: 580px) {
    .gallery-grid {
      column-count: 1;
    }
  }

  .modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(233, 233, 233, 0.95);
    z-index: 1000;
    align-items: center;
    justify-content: center;
  }

  .modal.active {
    display: flex;
  }

  .modal-content {
    max-width: 90%;
    max-height: 90vh;
    display: flex;
    flex-direction: column;
    align-items: center;
  }

  .modal-content img {
    max-width: 100%;
    max-height: 90vh;
    object-fit: contain;
    opacity: 1;
    transition: opacity 0.3s ease;
  }

  .modal-content img.fading {
    opacity: 0;
  }

  .modal-close {
    position: absolute;
    top: 0.5rem;
    right: 2rem;
    background: none;
    border: none;
    color: var(--secondary-text-color);
    font-size: 2rem;
    cursor: pointer;
    z-index: 1001;
    line-height: 1;
  }

  .modal-close:hover {
    text-decoration: underline;
  }

  .modal-nav {
    position: absolute;
    top: 50%;
    transform: translateY(-50%);
    background: none;
    border: none;
    color: var(--secondary-text-color);
    font-size: 4rem;
    font-weight: 10;
    cursor: pointer;
    line-height: 1;
  }

  .modal-nav:hover {
    text-decoration: underline;
  }

  .modal-prev {
    left: 1rem;
  }

  .modal-next {
    right: 1rem;
  }
</style>
